<div class="container">
    <div class="page-profile">
      <div class="row">
        <div class="col-md-3">
          <section class="panel">
              
            <div class="panel-body noradius padding-10">

              <figure class="margin-bottom-10">
                <% if(!user.avatar){ %>
                  <img
                    class="img-responsive"
                    src="/member/img/user.png"
                    alt
                  />
                <% } else { %>
                  <img
                    class="img-responsive"
                    src="/uploads/member/avatar/<%= user.avatar %>"
                    alt
                  />
                <% } %>
              </figure>

              <h6 class="progress-head">
                Hoàn thành hồ sơ<span class="pull-right">60%</span>
              </h6>
              <div class="progress progress-xs">
                <div
                  class="progress-bar"
                  role="progressbar"
                  style="width: 60%"
                ></div>
              </div>

              <hr class="half-margins" />

              <h3 class="text-black">
                <%= user.name %>
                <small class="text-gray size-14"> / <%= user.role %></small>
              </h3>
              <p class="size-12">
                Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed
                diam nonummy nibh euismod tincidunt laoreet dolore magna
                aliquam tincidunt erat volutpat laoreet dolore magna aliquam
                tincidunt erat volutpat.
              </p>

              <hr class="half-margins" />

              <h6>Mạng xã hội</h6>
              <a
                href="#"
                class="btn ico-only btn-facebook btn-xs"
                title="Facebook"
                ><i class="fa fa-facebook"></i
              ></a>
              <a
                href="#"
                class="btn ico-only btn-twitter btn-xs"
                title="Twitter"
                ><i class="fa fa-twitter"></i
              ></a>
              <a
                href="#"
                class="btn ico-only btn-google-plus btn-xs"
                title="Google plus"
                ><i class="fa fa-google-plus"></i
              ></a>
              <a
                href="#"
                class="btn ico-only btn-linkedin btn-xs"
                title="Linked In"
                ><i class="fa fa-linkedin"></i
              ></a>
              <a
                href="#"
                class="btn ico-only btn-pinterest btn-xs"
                title="Pinterest"
                ><i class="fa fa-pinterest"></i
              ></a>
              <a
                href="#"
                class="btn ico-only btn-instagram btn-xs"
                title="Instagram"
                ><i class="fa fa-instagram"></i
              ></a>
              <a
                href="#"
                class="btn ico-only btn-dribbble btn-xs"
                title="Dribble"
                ><i class="fa fa-dribbble"></i
              ></a>
              <a
                href="#"
                class="btn ico-only btn-youtube btn-xs"
                title="Youtube"
                ><i class="fa fa-youtube"></i
              ></a>
              <a href="#" class="btn ico-only btn-vimeo btn-xs" title="Vimeo"
                ><i class="fa fa-vimeo-square"></i
              ></a>
            </div>
          </section>
        </div>

        <div class="col-md-5">
          <div class="tabs white nomargin-top">
            <div class="tab-content">
              <div id="edit" class="tab-pane active">
                <form class="form-horizontal padding-10" action="/api/member/update-info-member/<%= user._id %>?_method=PUT"  method="POST" enctype="multipart/form-data">
                  <h4 class="text-center">Thông tin cá nhân</h4>
                  <fieldset>
                    <div class="form-group">
                      <label
                        class="col-md-3 control-label"
                        for="profileName"
                        >Họ và tên</label
                      >
                      <div class="col-md-8">
                        <input
                          type="text"
                          class="form-control"
                          id="profileName"
                          value="<%= user.name %>"
                          name="name"
                          maxlength="24"
                          minlength="6"
                          required
                        />
                      </div>
                    </div>
                    <div class="form-group">
                      <label
                        class="col-md-3 control-label"
                        for="profileEmail"
                        >Email</label
                      >
                      <div class="col-md-8">
                        <input
                          type="email"
                          class="form-control"
                          id="profileEmail"
                          name="email"
                          value="<%= user.email %>"
                          required
                        />
                      </div>
                    </div>
                    <div class="form-group">
                      <label
                        class="col-md-3 control-label"
                        for="profilePhoneNumber"
                        >Số điện thoại</label
                      >
                      <div class="col-md-8">
                        <input
                          type="text"
                          pattern="[0-9]*" oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                          class="form-control"
                          name="phoneNumber"
                          minlength="10"
                          id="profilePhoneNumber"
                          value="<%= user.phoneNumber %>"
                        />
                      </div>
                    </div>
                    <div class="form-group">
                      <label
                        class="col-md-3 control-label"
                        for="profileDOB"
                        >Ngày sinh</label
                      >
                      <div class="col-md-8">
                        <input
                          type="date"
                          class="form-control"
                          name="dob"
                          id="profileDOB"
                        />
                      </div>
                    </div>
                    <div class="form-group">
                      <label
                        class="col-md-3 control-label"
                        for="profileGender"
                        >Giới tính</label
                      >
                      <div class="col-md-8">
                        <input type="radio" id="male" name="gender" value="male">
                        <label for="male">Nam</label>&ensp;
                        <input type="radio" id="female" name="gender" value="female">
                        <label for="female">Nữ</label>&ensp;
                        <input type="radio" id="other" name="gender" value="other">
                        <label for="other">Khác</label>
                      </div>
                    </div>
                    <div class="form-group">
                      <label
                        class="col-md-3 control-label"
                        for="profileAddress"
                        >Địa chỉ</label
                      >
                      <div class="col-md-8">
                        <input
                          type="text"
                          class="form-control"
                          id="profileAddress"
                          name="address"
                          value="<%= user.address %>"
                        />
                      </div>
                    </div>
                    <div class="form-group">
                      <label
                        class="col-md-3 control-label"
                        for="profileCompany"
                        >Công ty</label
                      >
                      <div class="col-md-8">
                        <input
                          type="text"
                          class="form-control"
                          id="profileCompany"
                          name="company"
                          value="<%= user.company %>"
                        />
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="sky-form">
                        <label class="col-xs-3 control-label">Profile Image</label>
                        <div class="col-md-8">
                          <input type="file" name="avatar" accept="image/jpeg, image/jpg, image/png, image/gif" id="avatarImageFileInput">
                          <img id="previewImage" src="" alt="IMG" height="100" width="100">
                        </div>
                      </div>
                    </div>
                  </fieldset>
                  <div class="row">
                    <div class="col-md-9 col-md-offset-3">
                      <button type="submit" class="btn btn-primary">
                        Submit
                      </button>
                      <button type="reset" class="btn btn-default">
                        Reset
                      </button>
                    </div>
                  </div>
                </form>
                  <hr />
                <form class="form-horizontal padding-10" id="formChangePassword" method="POST">
                  <h4 class="text-center">Đổi mật khẩu</h4>
                  <fieldset class="mb-xl">
                    <div class="form-group">
                      <label
                        class="col-md-3 control-label"
                        for="profileNewPassword"
                        >Mật khẩu cũ</label
                      >
                      <div class="col-md-8">
                        <input id="oldPassword" type="password" name="oldPassword" pattern="[0-9a-zA-Z@#$%&]{6,}" class="form-control" required/>
                      </div>
                    </div>
                    <div class="form-group">
                      <label
                        class="col-md-3 control-label"
                        for="profileNewPasswordRepeat"
                        >Mật khẩu mới</label
                      >
                      <div class="col-md-8">
                        <input id="newPassword" type="password" name="newPassword" pattern="[0-9a-zA-Z@#$%&]{6,}" class="form-control" required/>
                      </div>
                    </div>
                  </fieldset>
                  <div class="row">
                    <div class="col-md-9 col-md-offset-3">
                      <button type="submit" class="btn btn-primary">
                        Submit
                      </button>
                      <button type="reset" class="btn btn-default">
                        Reset
                      </button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <section class="panel panel-default">
            <header class="panel-heading">
              <h2 class="panel-title elipsis">
                <i class="fa fa-rss"></i> Projects
              </h2>
            </header>
            <div class="panel-body noradius padding-10">
              <ul class="bullet-list list-unstyled">
                <li class="red">
                  <h3>Epona HTML5 Template</h3>
                  <span class="text-gray size-12"
                    >Lorem ipsum dolor sit amet, consectetuer adipiscing
                  </span>
                </li>
                <li class="green">
                  <h3>Atropos Template</h3>
                  <span class="text-gray size-12"
                    >Lorem ipsum dolor sit amet, consectetuer adipiscing
                  </span>
                </li>
                <li class="blue">
                  <h3>isisone Template</h3>
                  <span class="text-gray size-12"
                    >Lorem ipsum dolor sit amet, consectetuer adipiscing
                  </span>
                </li>
                <li class="orange">
                  <h3>Deusone Template</h3>
                  <span class="text-gray size-12"
                    >Lorem ipsum dolor sit amet, consectetuer adipiscing
                  </span>
                </li>
              </ul>
            </div>
          </section>

          <section class="panel panel-default">
            <header class="panel-heading">
              <h2 class="panel-title elipsis">
                <i class="fa fa-rss"></i> Activity
              </h2>
            </header>
            <div class="panel-body noradius padding-10">
              <div class="row profile-activity">
                <div class="col-xs-2 col-sm-1">
                  <time datetime="2014-06-29" class="datebox">
                    <strong>Jun</strong>
                    <span>29</span>
                  </time>
                </div>
                <div class="col-xs-10 col-sm-11">
                  <h6>
                    <a href="page-sidebar.html">Lorem ipsum dolor sit amet</a>
                  </h6>
                  <p>
                    Lorem ipsum dolor sit amet, consectetuer adipiscing elit,
                    sed diam nonummy nibh euismod tincidunt laoreet dolore
                    magna aliquam tincidunt erat volutpat laoreet dolore magna
                    aliquam tincidunt erat volutpat.
                  </p>
                </div>

                <div class="col-sm-12">
                  <hr class="half-margins" />
                </div>

                <div class="col-xs-2 col-sm-1">
                  <time datetime="2014-06-29" class="datebox">
                    <strong>Jun</strong>
                    <span>29</span>
                  </time>
                </div>
                <div class="col-xs-10 col-sm-11">
                  <h6>
                    <a href="page-sidebar.html"
                      >Sed diam nonummy nibh euismod</a
                    >
                  </h6>
                  <p>
                    Lorem ipsum dolor sit amet, consectetuer adipiscing elit,
                    sed diam nonummy nibh euismod tincidunt laoreet dolore
                    magna aliquam tincidunt erat volutpat laoreet dolore magna
                    aliquam tincidunt erat volutpat.
                  </p>
                </div>

                <div class="col-sm-12">
                  <hr class="half-margins" />
                </div>

                <div class="text-center">
                  <ul class="pagination pagination-sm">
                    <li class="disabled"><a href="#">Prev</a></li>
                    <li class="active"><a href="#">1</a></li>
                    <li><a href="#">2</a></li>
                    <li><a href="#">3</a></li>
                    <li><a href="#">4</a></li>
                    <li><a href="#">Next</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>
</div>

<script>
  var DateString = '<%= user.dob %>';
  var DateObject = new Date(DateString);
  var Year = DateObject.getFullYear();
  var Month = ("0" + (DateObject.getMonth() + 1)).slice(-2);
  var Day = ("0" + DateObject.getDate()).slice(-2);
  var FormattedDate = Year + "-" + Month + "-" + Day;
  console.log(DateString);

  document.getElementById('profileDOB').value = FormattedDate;

  const userGender = '<%= user.gender %>';

  const radioButtons = document.getElementsByName("gender");
  for (let i = 0; i < radioButtons.length; i++) {
    if (radioButtons[i].value === userGender) {
      radioButtons[i].checked = true;
    }
  }

  const fileInput = document.getElementById('avatarImageFileInput');
    fileInput.addEventListener('change', function(event) {
    // Lấy tệp tin đã chọn
    const file = event.target.files[0];

    if(file){
      var reader = new FileReader();

      reader.addEventListener('load', function() {
        previewImage.src = reader.result;
      });

      reader.readAsDataURL(file);
    }
  });
</script>

<script>
  // handle change password
  document.querySelector('#formChangePassword').addEventListener('submit', async function(e) {
    e.preventDefault(); // Ngăn chặn hành vi mặc định của form

    const oldPassword = document.getElementById('oldPassword').value;
    const newPassword = document.getElementById('newPassword').value;

    try {
      const response = await axios.post('/api/auth/reset-password', { oldPassword, newPassword });

      if (response.status === 200) {
        Swal.fire('Successfully', response.data.message, 'success').then(() => {
          location.reload(); // Reload lại trang
        });
      } else {
        throw new Error('Đổi mật khẩu thất bại. Vui lòng thử lại sau.');
      }
    } catch (error) {
      Swal.fire({
        title: 'Lỗi',
        text: `Lỗi: ${error}`,
        icon: 'error'
      });
    }
  });

</script>